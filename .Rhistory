"cattle_48")
means = lapply(colnames, function(name) { apply(virusresults[,grep(name, colnames(virusresults))], 1, mean) })
means = lapply(colnames, function(name) { apply(test[,grep(name, colnames(test))], 1, mean) })
meansdim())
meansdim()
means()
dim(means)
length(means)
result = do.call(cbind, means)
result
heatmap(result)
colnames(results)<-colnames
colnames(result)<-colnames
heatmap(result)
means = lapply(colnames, function(name) { apply(test[,grep(name, colnames(test))], 1, mean) })
result = do.call(cbind, means)
colnames(result) = colnames
heatmap(results,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("lightgrey",3),
rep("grey",5),
rep("darkgrey",5)),
cexCol=0.6)
heatmap(result,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("lightgrey",3),
rep("grey",5),
rep("darkgrey",5)),
cexCol=0.6)
heatmap(result,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("lightgrey",3),
rep("grey",5),
rep("darkgrey",5)),
cexCol=1.8)
head(result)
re <- result[order(result[,1]),]
re
head(re)
re <- result[order(-result[,1]),]
head(re)
m <- result[, order(as.integer(colnames(result)))]
m <- result[order(as.integer(colnames(result))),]
head(m)
m <- result[, order(as.integer(colnames(result)))]
head(m)
m <- result[order((colnames(result))),]
head(m)
m <- result[order((colnames(result))),]
head(m)
m <- result[,order(colnames(result))]
head(m)
m <- result[,order(colnames(result))]
heatmap(m,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("lightgrey",3),
rep("grey",5),
rep("darkgrey",5)),
cexCol=1.8)
heatmap(m,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("grey80",5),
rep("grey",5),
rep("grey10",3)),
cexCol=1.8)
heatmap(m,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("grey80",5),
rep("grey45",5),
rep("grey10",3)),
cexCol=1.8)
require(graphics); require(grDevices)
#setwd("C:/Users/David Hayman/Dropbox/marsden/ORION__sample_results")
data<-read.csv("06032015_run_mfp_scan_v5.csv",header=T,row.names=1)
colnames(data) <- c(#"UniqueID",
"human_3_S3_R1",
"human_3-Pur_S17_R1",
"human_3_S3_R2",
"human_3-Pur_S17_R2",
"human_2_S2_R1",
"human_2_S2_R2",
"human_2-Pur_S16_R1",
"human_2-Pur_S16_R2",
"Undetermined_S0_R2",
"Undetermined_S0_R1",
"gorilla_4_S4_R1",
"gorilla_4-Pur_S18_R1",
"gorilla_4_S4_R2",
"gorilla_4-Pur_S18_R2",
"cattle_60-Pur_S26_R1",
"cattle_60-Pur_S26_R2",
"cattle_60_S12_R1",
"cattle_60_S12_R2",
"cattle_56_S11_R1",
"cattle_56_S11_R2",
"cattle_56-Pur_S25_R1",
"cattle_56-Pur_S25_R2",
"cattle_62-Pur_S27_R2",
"cattle_62-Pur_S27_R1",
"cattle_62_S13_R1",
"cattle_62_S13_R2",
"human_1_S1_R2",
"human_1_S1_R1",
"human_1-Pur_S15_R1",
"human_1-Pur_S15_R2",
"gorilla_44_S8_R1",
"gorilla_44_S8_R2",
"gorilla_44-Pur_S22_R1",
"gorilla_44-Pur_S22_R2",
"gorilla_24-Pur_S20_R1",
"gorilla_24_S6_R1",
"gorilla_24_S6_R2",
"gorilla_24-Pur_S20_R2",
"gorilla_14-Pur_S19_R2",
"gorilla_14-Pur_S19_R1",
"gorilla_14_S5_R2",
"gorilla_14_S5_R1",
"gorilla_34-Pur_S21_R2",
"gorilla_34-Pur_S21_R1",
"gorilla_34_S7_R2",
"gorilla_34_S7_R1",
"cattle_52_S10_R2",
"cattle_52_S10_R1",
"cattle_52-Pur_S24_R2",
"cattle_52-Pur_S24_R1",
"cattle_48_S9_R2",
"cattle_48_S9_R1",
"cattle_48-Pur_S23_R2",
"cattle_48-Pur_S23_R1",
"Ctl_S14_R1",
"Ctl_S14_R2",
"Ctl-Pur_S28_R1",
"Ctl-Pur_S28_R2")
#
# data<-data.matrix(data)
# heatmap(data)
# heatmap(data,na.rm=T)
summary(data)
df1<-data[!(rowSums(data[,55:58])>0),]
summary(df1)
colnames = c( "human_3",
"human_2",
"gorilla_4",
"cattle_60",
"cattle_56",
"cattle_62",
"human_1",
"gorilla_44",
"gorilla_24",
"gorilla_14",
"gorilla_34",
"cattle_52",
"cattle_48")
# calculate the means
means = lapply(colnames, function(name) { apply(test[,grep(name, colnames(test))], 1, mean) })
test<-df1[,1:54]
test<-df1[,1:54]
heatmap(test,Colv=NA,labRow=NA,margins=c(12,7),cexCol=0.5)
colnames = c( "human_3",
"human_2",
"gorilla_4",
"cattle_60",
"cattle_56",
"cattle_62",
"human_1",
"gorilla_44",
"gorilla_24",
"gorilla_14",
"gorilla_34",
"cattle_52",
"cattle_48")
# calcu
means = lapply(colnames, function(name) { apply(test[,grep(name, colnames(test))], 1, mean) })
result = do.call(cbind, means)
#result = as.data.frame(t(result))
colnames(result) = colnames
#
m <- result[,order(colnames(result))]
head(m)
head(result[,order(result[1])])
result[,order(result[1])]
head(result[,order(result[1])])
max(result[,1])
which(max(result[,1]))
which[max(result[,1])]
max(result[,1])
which.max( result[,1] )
which.max( result[,2] )
which.max( result[,3] )
which.max( result[,4] )
which.max( result[,5] )
which.max( result[,6] )
dim(result)
which.max( result[,1:13] )
which.max( result[,13] )
( result[10,13] )
which.max( result[,12] )
which.max( result[,13] )
which.max( result[,11] )
which.max( result[,12] )
which.max( result[,10] )
which.max( result[,9] )
which.max( result[,8] )
summary(result)
which.max( result[,7] )
which.max( result[,6] )
order(result[,2],decreasing=T)[1]
order(result[,1],decreasing=T)[1]
order(result[,1],decreasing=T)
result
head(result)
write.csv(result,"res_all.csv")
require(graphics); require(grDevices)
data<-read.csv("06032015_run_mfp_scan_v5.csv",header=T,row.names=1)
colnames(data) <- c(#"UniqueID",
"human_3_S3_R1",
"human_3-Pur_S17_R1",
"human_3_S3_R2",
"human_3-Pur_S17_R2",
"human_2_S2_R1",
"human_2_S2_R2",
"human_2-Pur_S16_R1",
"human_2-Pur_S16_R2",
"Undetermined_S0_R2",
"Undetermined_S0_R1",
"gorilla_4_S4_R1",
"gorilla_4-Pur_S18_R1",
"gorilla_4_S4_R2",
"gorilla_4-Pur_S18_R2",
"cattle_60-Pur_S26_R1",
"cattle_60-Pur_S26_R2",
"cattle_60_S12_R1",
"cattle_60_S12_R2",
"cattle_56_S11_R1",
"cattle_56_S11_R2",
"cattle_56-Pur_S25_R1",
"cattle_56-Pur_S25_R2",
"cattle_62-Pur_S27_R2",
"cattle_62-Pur_S27_R1",
"cattle_62_S13_R1",
"cattle_62_S13_R2",
"human_1_S1_R2",
"human_1_S1_R1",
"human_1-Pur_S15_R1",
"human_1-Pur_S15_R2",
"gorilla_44_S8_R1",
"gorilla_44_S8_R2",
"gorilla_44-Pur_S22_R1",
"gorilla_44-Pur_S22_R2",
"gorilla_24-Pur_S20_R1",
"gorilla_24_S6_R1",
"gorilla_24_S6_R2",
"gorilla_24-Pur_S20_R2",
"gorilla_14-Pur_S19_R2",
"gorilla_14-Pur_S19_R1",
"gorilla_14_S5_R2",
"gorilla_14_S5_R1",
"gorilla_34-Pur_S21_R2",
"gorilla_34-Pur_S21_R1",
"gorilla_34_S7_R2",
"gorilla_34_S7_R1",
"cattle_52_S10_R2",
"cattle_52_S10_R1",
"cattle_52-Pur_S24_R2",
"cattle_52-Pur_S24_R1",
"cattle_48_S9_R2",
"cattle_48_S9_R1",
"cattle_48-Pur_S23_R2",
"cattle_48-Pur_S23_R1",
"Ctl_S14_R1",
"Ctl_S14_R2",
"Ctl-Pur_S28_R1",
"Ctl-Pur_S28_R2")
#
data<-data.matrix(data)
data<-data.matrix(data)
heatmap(data,na.rm=T)
df1<-data[!(rowSums(data[,55:58])>0),]
test<-df1[,1:54]
# heatmap(test,Colv=NA,labRow=NA,margins=c(12,7),cexCol=0.5)
colnames = c( "human_3",
"human_2",
"gorilla_4",
"cattle_60",
"cattle_56",
"cattle_62",
"human_1",
"gorilla_44",
"gorilla_24",
"gorilla_14",
"gorilla_34",
"cattle_52",
"cattle_48")
# calculate the means
means = lapply(colnames, function(name) { apply(test[,grep(name, colnames(test))], 1, mean) })
# build the result
result = do.call(cbind, means)
#result = as.data.frame(t(result))
colnames(result) = colnames
#
m <- result[,order(colnames(result))]
heatmap(m,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("grey80",5),
rep("grey45",5),
rep("grey10",3)),
cexCol=1.8)
heatmap(df1)
heatmap(df1,Colv=NA)
heatmap(df1,Colv=NA,labRow=NA)
heatmap(m,Colv=NA,
labRow=NA,col=terrain.colors(20, alpha = 1),
margins=c(12,7),
ColSideColors = c(rep("grey80",5),
rep("grey45",5),
rep("grey10",3)),
cexCol=1.8)
heatmap(m)
virusresults<-test[grep("virus",res),] # returns those with 'virus' in
res<-rownames(test)
virusresults<-test[grep("virus",res),] # returns those with 'virus' in
virusres<-as.data.frame(virusresults)
virusres$virus<-rownames(virusres)
virusres<-virusres[-c(1,6),]
library(ggplot2)
library(plyr)
library(reshape2)
vres<-melt(virusres)
p <- qplot(x=virus, y=value, fill=variable,
data=vres, geom="bar", stat="identity",
position="dodge",ylab="reads")
p+theme(text = element_text(size=20),
axis.text.x = element_text(angle=90, vjust=1,colour="grey20"))
p <- qplot(x=virus, y=value, fill=variable,
data=vres, geom="bar", stat="identity",
position="stack",ylab="reads")
p+theme(text = element_text(size=20),
axis.text.x = element_text(angle=90, vjust=1,colour="grey20"))
virusres[virusres == 0]<-NA
virusres <- virusres[,colSums(is.na(virusres))<nrow(virusres)]
virusres
vres<-melt(virusres)
p <- qplot(x=virus, y=value, fill=variable,
data=vres, geom="bar", stat="identity",
position="dodge",ylab="reads")
p+theme(text = element_text(size=20),
axis.text.x = element_text(angle=90, vjust=1,colour="grey20"))+
scale_fill_hue(c=90, l=55)+ scale_fill_brewer(palette="Set1")
p <- qplot(x=virus, y=value, fill=variable,
data=vres, geom="bar", stat="identity",
position="stack",ylab="reads")
p+theme(text = element_text(size=20),
axis.text.x = element_text(angle=90, vjust=1,colour="grey20"))+
scale_fill_hue(c=90, l=55)+ scale_fill_brewer(palette="Set1")
names(vres)<-c("virus","host","value")
p <- qplot(x=virus, y=value, fill=host,
data=vres, geom="bar", stat="identity",
position="dodge",ylab="reads")
p+ theme(text = element_text(size=20),
axis.title.x=element_blank(),
axis.text.x = element_text(angle=90, vjust=1,colour="grey20"))+
scale_fill_hue(c=90, l=55)+ scale_fill_brewer(palette="Set1")
colnames = c( "human_3",
"human_2",
"gorilla_4",
"cattle_60",
"cattle_56",
"cattle_62",
"human_1",
"gorilla_44",
"gorilla_24",
"gorilla_14",
"gorilla_34",
"cattle_52",
"cattle_48")
# calculate the means
means = lapply(colnames, function(name) { apply(virusresults[,grep(name, colnames(virusresults))], 1, mean) })
# build the result
result = do.call(cbind, means)
result = as.data.frame(t(result))
rownames(result) = colnames
### KEEP TO REMOVE HAs IF NEEDED
result[result == 0]<-NA
result <- result[rowSums(is.na(result))<ncol(result),]
result
colnames(result)<-c("Microvirus","Picobirnavirus",
"D - picobirnavirus","Hepatitis C virus",
"Lassa virus","Hyposoter fugitivus ichnovirus")
result<-result[,2:5]
vs_r<-melt(t(result))
colnames(vs_r)<-c("virus","host","reads")
p <- qplot(x=virus, y=reads, fill=host,
data=vs_r, geom="bar", stat="identity",
position="dodge",ylab="reads")
p+theme(text = element_text(size=20),
axis.text.x = element_text(angle=90, vjust=1,colour="grey20"))+
scale_fill_hue(c=90, l=55)+ scale_fill_brewer(palette="Set1")
p <- qplot(x=virus, y=reads, fill=host,
data=vs_r, geom="bar", stat="identity",
position="stack",ylab="reads",asp=1)
p+theme(text = element_text(size=20),
axis.text.x = element_text(angle=90, vjust=1,colour="grey20"))+
scale_fill_hue(c=90, l=55)+ scale_fill_brewer(palette="Set1")
ggplot(data=vs_r, aes(x=host,y=reads, fill=host)) +
labs(y="Mean reads") +
geom_bar(position='dodge',stat="identity")+
facet_wrap( ~virus , nrow=1)+
theme( axis.text.x = element_text(angle = 90,colour = "grey10"),
text = element_text(size=20))
colnames(vs_r)[2]<-c("host_id")
ggplot(data=vs_r, aes(x=host_id,y=reads, fill=host_id)) +
labs(y="mean reads") +
geom_bar(position='dodge',stat="identity")+
facet_wrap( ~virus , nrow=1)+
theme( axis.text.x = element_blank(),
axis.title.x = element_blank(),
text = element_text(size=20))
# vres[order(vres$virus),]
#
# ##################
#
# library(gplots)
# heatmap.2(test,dendrogram="row",labRow=NA,
#          col=heat.colors(20),  cexCol=1,
#          scale="col")
#
# heatmap.2(test,dendrogram="row",
#           # col=heat.colors(120),
#           cexCol=1,scale="row",labRow=NA,
#           density.info="none")
#
# heatmap.2(test,dendrogram="row", #col=redgreen(75),
#           scale="row"
write.csv(res,"res.csv")
head(m)
write.csv(m,"res.csv")
virusresults
source('~/GitHub/ctph/test_plots.R', echo=TRUE)
df2<-data[!(rowSums(data[,1:58])>0),]
dim(df2)
head(means)
dim(means)
length(means)
head(results)
head(result)
data<-data.matrix(data)
# heatmap(data,na.rm=T)
## to remove the contamination
df1<-data[!(rowSums(data[,55:58])>0),]
heatmap(df1,Colv=NA,labRow=NA)
test<-df1[,1:54]
# heatmap(test,Colv=NA,labRow=NA,margins=c(12,7),cexCol=0.5)
colnames = c( "human_3",
"human_2",
"gorilla_4",
"cattle_60",
"cattle_56",
"cattle_62",
"human_1",
"gorilla_44",
"gorilla_24",
"gorilla_14",
"gorilla_34",
"cattle_52",
"cattle_48")
# calculate the means
means = lapply(colnames, function(name) { apply(test[,grep(name, colnames(test))], 1, mean) })
dim(means)
str(means)
class(means)
# build the result
result = do.call(cbind, means)
colnames(result) = colnames
dim(results)
dim(result)
df2<-result[!(rowSums(result[,1:13])>0),]
heatmap(df2,Colv=NA,labRow=NA)
dim(df2)
df2
result[which(result==0)] = NA
result[complete.cases(result[,1:13]),]
df2<-result[complete.cases(result[,1:13]),]
dim(df2)
complete.cases(result[,1:13])
summary(result)
df2<-result[!complete.cases(result[,1:13]),]
dim(df2)
summary(df2)
df2<-result[,!complete.cases(result[,1:13])]
result = do.call(cbind, means)
#result = as.data.frame(t(result))
colnames(result) = colnames
#
result[which(result==0)] = NA
df2<-result[complete.cases(result),]
dim(df2)
df2<-result[!complete.cases(result),]
dim(df2)
summary(df2)
head(df2)
tail(df2)
heatmap(df2,Colv=NA,labRow=NA)
result[is.na(result)] <- 0
df2[is.na(df2)] <- 0
heatmap(df2,Colv=NA,labRow=NA)
